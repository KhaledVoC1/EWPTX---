# ๐ ุงูุฌูุณุฉ 8: Cross-Site Request Forgery (CSRF) + Token-Based Authentication
## Slides 107 โ 121

---

## ๐ Slide 107-108: CSRF - ุงูุชุนุฑูู ูุงูููููู
### Cross-Site Request Forgery (CSRF)

ุฃููุงู ุจูู ูู ุงูุฌูุณุฉ ุงูุซุงููุฉ! ๐ฅ ุงูุฌูุณุฉ ุฏู ูููุง ูุฌูุฉ ูู ุฃุฎุทุฑ ุงููุฌูุงุช: **CSRF**!

### ุงูุชุนุฑูู:
> **CSRF (Cross-Site Request Forgery)** ูู ุซุบุฑุฉ ุฃูููุฉ ุจุชุญุตู ููุง ุงูููุงุฌู ูุฎุฏุน ุงููุณุชุฎุฏู ุฅูู ูุนูู ุฅุฌุฑุงุกุงุช ุนูู ุชุทุจูู ููุจ **ุจุฏูู ุนููู ุฃู ููุงููุชู**. ุงููุฌูุฉ ุจุชุณุชุบู **ุซูุฉ ุงูุชุทุจูู ูู ูุชุตูุญ ุงููุณุชุฎุฏู**.

### ุจุงููุตุฑู ูุฏู:
ุชุฎูู ุฅูู ูุณุฌู ุฏุฎูู ูู ูููุน ุงูุจูู ุจุชุงุนู. ูุฃูุช ูุณู ูุณุฌู ุฏุฎููุ ุญุฏ ุจุนุชูู ูููู ุนูู ูุงุชุณุงุจ ูุงูู "ุดูู ุงูุตูุฑุฉ ุงูุญููุฉ ุฏู". ุถุบุทุช ุนูู ุงููููู โ ุงูุตูุญุฉ ุงููู ูุชุญุช ูููุง ููุฏ ูุฎูู ุนูู ุชุญููู ูููุณ ูู ุญุณุงุจู ุจุฏูู ูุง ุชุญุณ! ๐

### ููู ุงููุฌูุฉ ุจุชูุฌุญุ

```
ุงูุณุจุจ ุงูุฌููุฑู: ุงููุชุตูุญ ุจูุจุนุช ุงูู Cookies ุชููุงุฆูุงู!

ุนุงุฏุฉู:                             ูู CSRF:
ุงููุณุชุฎุฏู ุจูุถุบุท "ุชุญููู"              ูููุน ุฎุจูุซ ุจูุจุนุช ููุณ ุงูุทูุจ
ูู ูููุน ุงูุจูู                       ุจุงูููุงุจุฉ ุนู ุงููุณุชุฎุฏู
   โ                                     โ
   โผ                                     โผ
POST /transfer                      POST /transfer
Cookie: session=xyz โ ุชููุงุฆู!      Cookie: session=xyz โ ุชููุงุฆู!
to=friend&amount=100                to=hacker&amount=10000

ุงูุณูุฑูุฑ ูุด ุจููุฑู ุจูู ุงูุงุชููู!
ุงูู Cookie ุตุญูุญุฉ ูู ุงูุญุงูุชูู โ
ุงูู Request ุจูุชููุฐ! ๐
```

---

## ๐ Slide 109-110: ูููุฌูุฉ ูุฌูู CSRF
### CSRF Attack Methodology

### ุงูุฎุทูุงุช ุจุงูุชูุตูู:

### ุงูุฎุทูุฉ 1: ุงูููุงุฌู ุจูุตูุน ุงูุทูุจ ุงูุฎุจูุซ ๐จ
```html
<!-- ุงูููุงุฌู ุจูุนูู ุตูุญุฉ ููุจ ูููุง Form ูุฎูู -->
<html>
<body>
  <h1>๐ ูุจุฑูู! ูุณุจุช ุฌุงุฆุฒุฉ!</h1>
  
  <!-- Form ูุฎูู ุจูุญูู ูููุณ -->
  <form action="https://bank.com/transfer" method="POST" id="evilForm">
    <input type="hidden" name="to" value="hacker_account">
    <input type="hidden" name="amount" value="10000">
  </form>
  
  <!-- ุจูุชุจุนุช ุชููุงุฆูุงู ููุง ุงูุตูุญุฉ ุชุชุญูู -->
  <script>
    document.getElementById('evilForm').submit();
  </script>
</body>
</html>
```

### ุงูุฎุทูุฉ 2: ุงูููุงุฌู ุจููุตูู ุงูุถุญูุฉ ููุตูุญุฉ ๐ฃ
```
ุทุฑู ุงูุชูุตูู:
1. ุฅูููู: "ุงุถุบุท ููุง ุนุดุงู ุชุดูู ุงููุงุชูุฑุฉ"
2. ูุงุชุณุงุจ/ุชูููุฌุฑุงู: "ุดูู ุงูุนุฑุถ ุฏู!"
3. ุณูุดูุงู ููุฏูุง: ุจูุณุช ููู ูููู ูุบุฑู
4. ุฅุนูุงู ุนูู ูููุน: Ad ุจููุชุญ ุงูุตูุญุฉ ุงูุฎุจูุซุฉ
5. ุญุชู ุตูุฑุฉ: <img src="https://bank.com/transfer?to=hacker&amount=100">
```

### ุงูุฎุทูุฉ 3: ุงููุชุตูุญ ุจูุจุนุช ุงูุทูุจ + ุงูู Cookie ุชููุงุฆูุงู ๐
```http
POST /transfer HTTP/1.1
Host: bank.com
Cookie: session=victim_session_xyz    โ ุงููุชุตูุญ ุจุนุชูุง ุชููุงุฆู!
Content-Type: application/x-www-form-urlencoded

to=hacker_account&amount=10000
```

### ุงูุฎุทูุฉ 4: ุงูุณูุฑูุฑ ุจูููุฐ ุงูุทูุจ ๐
```
ุงูุณูุฑูุฑ ุจูุดูู:
โ ุงูู Session Cookie ุตุญูุญุฉ
โ ุงูุทูุจ ููู ูู ุงูุญููู ุงููุทููุจุฉ
โ ูุด ุจูุนุฑู ุฅู ุงูุทูุจ ุฌู ูู ูููุน ุชุงูู!

โ ุจูุญูู ุงููููุณ ูุญุณุงุจ ุงูููุงุฌู!
```

---

## ๐ Slide 111: ุชุฃุซูุฑ ูุฌูุงุช CSRF
### CSRF Impact

### ุงูุนูุงูุจ ุฎุทูุฑุฉ! 

```
๐ฐ ุชุญููู ุฃููุงู ุจุฏูู ุฅุฐู
๐ ุชุบููุฑ ุงูุจุงุณูุฑุฏ ุฃู ุงูุฅูููู
๐ค ุชุนุฏูู ุจูุงูุงุช ุงูุญุณุงุจ
๐ง ุฅุฑุณุงู ุฑุณุงุฆู ุจุงุณู ุงูุถุญูุฉ
๐ ุนูููุงุช ุดุฑุงุก ุบูุฑ ูุตุฑุญ ุจูุง
๐ ูู ุงูุถุญูุฉ Admin โ ุชุบููุฑ ุฅุนุฏุงุฏุงุช ุงููุธุงู ููู!
```

### ุณููุงุฑูู ูุงูุนู:
```
CSRF ุนูู ูููุน ุฅุฏุงุฑุฉ Router (192.168.1.1):

<img src="http://192.168.1.1/admin/change_dns?dns1=8.8.8.8&dns2=evil.dns">

ูู ุงูุฃุฏูู ูุงุชุญ ุงููุชุตูุญ ููุณุฌู ุฏุฎูู ูู ุงูุฑุงูุชุฑ
โ ุงูู DNS ุจุชุงุน ุงูุฑุงูุชุฑ ุงุชุบูุฑ!
โ ูู ุฌูุงุฒ ุนูู ุงูุดุจูุฉ ุจูู ุจูุฑูุญ ูุณูุฑูุฑุงุช ุงูููุงุฌู!
โ ุฏู ุงุณูู DNS Hijacking ุนุจุฑ CSRF ๐
```

### ุงูุญูุงูุฉ ูู CSRF:

```
1. CSRF Tokens (Anti-CSRF Tokens):
   ูู Form ุจูุญุชูู ุนูู Token ุณุฑู ุนุดูุงุฆู
   ุงูุณูุฑูุฑ ุจูุชุญูู ููู ูุน ูู Request
   ุงูููุงุฌู ูุด ููุฏุฑ ูุนุฑู ุงูู Token!

2. SameSite Cookie Attribute:
   SameSite=Lax โ ุงูู Cookie ูุด ุจุชุชุจุนุช ูุน Cross-Site POST
   ุฏู ุจูููุน ุงููุฌูุฉ ูู ุงูุฃุณุงุณ!

3. Referer/Origin Header Check:
   ุงูุณูุฑูุฑ ุจูุชุญูู ูู ูุตุฏุฑ ุงูุทูุจ
   ูู ุฌุงู ูู domain ุชุงูู โ ูุฑูุถู!

4. Custom Headers (ููู APIs):
   X-Requested-With: XMLHttpRequest
   ุงูู Cross-Origin Requests ูุด ุจุชูุฏุฑ ุชุถูู Custom Headers
```

---

## ๐ Slide 112: Lab Demo - CSRF
### ๐งช Lab Demo: Cross-Site Request Forgery

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:
```
1. ุณุฌู ุฏุฎูู ูู ุงูุชุทุจูู ุงููุณุชูุฏู
2. ุฑูุญ ูุตูุญุฉ ุชุบููุฑ ุงูุฅูููู ุฃู ุงูุจุงุณูุฑุฏ
3. ูู Burp Suite ุงุนุชุฑุถ ุงูู Request
4. ุดูู:
   - ูู ููู CSRF Token ูู ุงูู Form?
   - ูู ููู: ุฌุฑุจ ุงุญุฐูู - ูู ุงูู Request ุจููุฌุญุ
   - ูู ููู: ุฌุฑุจ ุบูุฑู ููููุฉ ุนุดูุงุฆูุฉ - ูู ุจููุฌุญุ
   - ูู ูููุด Token ุฎุงูุต: CSRF Vulnerability! โ

5. ุงุนูู Proof of Concept:
   - ุงุณุชุฎุฏู Burp โ Right Click โ Engagement Tools โ Generate CSRF PoC
   - ููุนููู ุตูุญุฉ HTML ุฌุงูุฒุฉ ููุงุฎุชุจุงุฑ
   - ุงูุชุญูุง ูู ูุชุตูุญ ุชุงูู ูุฃูุช ูุณุฌู ุฏุฎูู
   - ูู ุงูุนูููุฉ ุงุชููุฐุช = CSRF Confirmed! ๐
```

---

## ๐ Slide 113-114: ููุฏูุฉ ูู Token-Based Authentication
### Introduction to Token-Based Authentication

### ุจูุณูุจ ุงูู Sessions ููุชููู ุนู ุงูุชุทูุฑ ุงูุฌุฏูุฏ! ๐

### ุงูุชุนุฑูู:
> **Token-Based Authentication** ูู ุทุฑููุฉ ุญุฏูุซุฉ ููุชุญูู ูู ูููุฉ ุงููุณุชุฎุฏููู. ุจุฏู ูุง ุงูุณูุฑูุฑ ูุญุชูุธ ุจุงูู Session Data ุนูุฏู (Stateful)ุ ุจูุตุฏุฑ **Token** ููุนููู ุจูุญุชูู ุนูู ูู ุงููุนูููุงุช ุงููุทููุจุฉ (Stateless).

### ุงููุฑู ุจูู Session-Based ู Token-Based:

```
Session-Based (ุงููุฏูู):
โโโโโโโโโโโโโโโโ                    โโโโโโโโโโโโโโโโ
โ ุงููุชุตูุญ      โ   Cookie: ID=xyz   โ ุงูุณูุฑูุฑ      โ
โ              โ โโโโโโโโโโโโโโโโโโโบ โ              โ
โ ุนูุฏู:        โ                    โ ุนูุฏู:        โ
โ Session ID   โ                    โ Session Store โ
โ ุจุณ!          โ                    โ xyz โ {user,  โ
โ              โ                    โ   role, etc}  โ
โโโโโโโโโโโโโโโโ                    โโโโโโโโโโโโโโโโ
                                    โ ุงูุณูุฑูุฑ ูุงุฒู ูุฎุฒู!

Token-Based (ุงูุญุฏูุซ):
โโโโโโโโโโโโโโโโ                    โโโโโโโโโโโโโโโโ
โ ุงููุชุตูุญ      โ  Bearer: JWT_TOKEN โ ุงูุณูุฑูุฑ      โ
โ              โ โโโโโโโโโโโโโโโโโโโบ โ              โ
โ ุนูุฏู:        โ                    โ ุนูุฏู:        โ
โ Token ูุงูู   โ                    โ Secret Key   โ
โ ููู ูู       โ                    โ ุจุณ!          โ
โ ุงูุจูุงูุงุช!    โ                    โ ูุด ุจูุฎุฒู     โ
โ              โ                    โ ุญุงุฌุฉ!        โ
โโโโโโโโโโโโโโโโ                    โโโโโโโโโโโโโโโโ
                                    โ Stateless! ูุด ูุญุชุงุฌ ูุฎุฒู!
```

### ููู Token-Based ุฃูุถู ูู ุจุนุถ ุงูุญุงูุงุชุ
- โ **Scalability**: ุนูุฏู 10 ุณูุฑูุฑุงุชุ ูุด ูุญุชุงุฌ ุชุดุงุฑู Session Store ุจูููู
- โ **Cross-Domain**: ุจูุดุชุบู ุจูู ููุงูุน ูุฎุชููุฉ (ูุซุงูู ูู APIs)
- โ **Mobile-Friendly**: ุงูุชุทุจููุงุช ุจุชุชุนุงูู ูุน Tokens ุฃุณูู ูู Cookies
- โ **Microservices**: ูู Service ููุฏุฑ ูุชุญูู ูู ุงูู Token ุจุดูู ูุณุชูู

---

## ๐ Slide 115-117: ุฃููุงุน ุงูู Tokens
### Types of Tokens

### 1๏ธโฃ Bearer Tokens (ุงูุฃุจุณุท)

```http
GET /user/profile HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
```

**ุงูุงุณู ูุนูุงู:** "ุญุงูู" ุงูู Token = ุตุงุญุจ ุงูุตูุงุญูุฉ. ุฃู ุญุฏ ุนูุฏู ุงูู Token ููุฏุฑ ูุณุชุฎุฏูู!

**ุงููููุฒุงุช:**
- โ ุจุณูุท ูุณูู ุงูุชูููุฐ
- โ ุดุงุฆุน ุฌุฏุงู ูู APIs

**ุงูุนููุจ:**
- โ ูู ุญุฏ ุณุฑููุ ููุฏุฑ ูุณุชุฎุฏูู ููุฑุงู!
- โ ูุงุฒู ูููู Short-Lived ููุญูู ุจู HTTPS

### 2๏ธโฃ JSON Web Tokens - JWT (ุงูุฃุดูุฑ ูุงูุฃูู)

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvZSIsImlhdCI6MTUxNjIzOTAyMn0.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

**ุงูู JWT ุจูุชููู ูู 3 ุฃุฌุฒุงุก (ููุดุฑุญูู ุจุงูุชูุตูู ูู ุงูุฌูุณุฉ ุงูุฌุงูุฉ):**
- **Header**: ููุน ุงูู Token + ุฎูุงุฑุฒููุฉ ุงูุชูููุน
- **Payload**: ุงูุจูุงูุงุช (Claims) - ููู ุงููุณุชุฎุฏู ูุฅูู ุตูุงุญูุงุชู
- **Signature**: ุงูุชูููุน ุงููู ุจูุซุจุช ุฅู ุงูู Token ูุฒููุฑุด

**ุฎุตุงุฆุตู:**
- โ **Self-Contained**: ูู ุงูุจูุงูุงุช ุฌูุงู
- โ **Stateless**: ุงูุณูุฑูุฑ ูุด ูุญุชุงุฌ ูุฎุฒู ุญุงุฌุฉ
- โ **Portable**: ุจูุดุชุบู ูู ุฃู ููุงู

### 3๏ธโฃ OAuth Tokens (ููุชูููุถ)

```
OAuth ุจูุณุชุฎุฏู ููุนูู ูู ุงูู Tokens:

Access Token:    ุจูุฏู ุตูุงุญูุฉ ุงููุตูู (ุนูุฑู ูุตูุฑ - ุฏูุงูู/ุณุงุนุงุช)
Refresh Token:   ุจูุนูู Access Token ุฌุฏูุฏ (ุนูุฑู ุฃุทูู - ุฃูุงู/ุฃุณุงุจูุน)

ุงูุณููุงุฑูู:
1. ุงููุณุชุฎุฏู ุจูุณุฌู ุฏุฎูู ุนุจุฑ Google
2. Google ุจูุฏู ุงูุชุทุจูู Access Token + Refresh Token
3. ุงูุชุทุจูู ุจูุณุชุฎุฏู ุงูู Access Token ุนุดุงู ููุตู ูุจูุงูุงุช ุงููุณุชุฎุฏู
4. ููุง ุงูู Access Token ููุชูู โ ุจูุณุชุฎุฏู ุงูู Refresh Token ูุนูู ูุงุญุฏ ุฌุฏูุฏ
```

---

## ๐ Slide 118-121: Token Placement - ุฃูุงูู ุชุฎุฒูู ุงูู Token
### Token Placement

### ุฃูู ูุญุท ุงูู Tokenุ ุณุคุงู ููู ุฌุฏุงู ููุฃูุงู!

### 1๏ธโฃ Authorization Header โ (ุงูุฃูุถู)
```http
GET /api/v1/resource HTTP/1.1
Host: example.com
Authorization: Bearer <token>
```
- โ ุงูุฃูุซุฑ ุดููุนุงู ูุงูุฃูุซุฑ ุฃูุงูุงู
- โ ุงูู Token ูุด ูู ุงูู URL (ูุด ุจูุชุณุฌู ูู Logs)
- โ ุจูุดุชุบู ูุน ูู ุฃููุงุน ุงูู APIs

### 2๏ธโฃ Query Parameters โ (ุฎุทูุฑ!)
```http
GET /api/v1/resource?access_token=<token> HTTP/1.1
Host: example.com
```
- โ ุงูู Token ุธุงูุฑ ูู ุงูู URL!
- โ ุจูุชุณุฌู ูู Server Logs, Browser History, Referer Header
- โ ูููู ูุชุฎุฒู ูู Proxy Cache
- โ๏ธ ุงุณุชุฎุฏูู **ููุท** ููุง ูููุด ุจุฏูู (ุจุนุถ ุงูู WebSocket Connections)

### 3๏ธโฃ Request Body (ูู POST Requests)
```http
POST /api/v1/resource HTTP/1.1
Host: example.com
Content-Type: application/json

{ "token": "<token>" }
```
- โ ููุงุณุจ ููู POST Requests
- โ ูุด ุนููู ูู GET Requests
- โ๏ธ ูุชุณุชุฎุฏููุด ูู GET ูุฃู GET ูุด ูุตูู ูุดูู Data ุญุณุงุณุฉ

### 4๏ธโฃ Cookies โ (ูุน Flags ุงูุฃูููุฉ)
```http
Set-Cookie: auth_token=<token>; Secure; HttpOnly
```
- โ ุงููุชุตูุญ ุจูุจุนุชูุง ุชููุงุฆูุงู (ุณูู)
- โ HttpOnly ุจูููุน ุณุฑูุชูุง ุจู JavaScript
- โ ูุนุฑุถุฉ ูู CSRF (ูุงุฒู Anti-CSRF Token)

### 5๏ธโฃ Custom Headers (ูุชูุฏู)
```http
GET /api/v1/resource HTTP/1.1
Host: example.com
X-Auth-Token: <token>
```
- โ ุฃูู ุดููุนุงู = ุฃูู ุงุณุชูุฏุงูุงู
- โ ูููุฏุฉ ูู ุฃูุธูุฉ ุจูุชุทูุจุงุช ุฃูููุฉ ุฎุงุตุฉ
- โ ูุด Standard

### ุฌุฏูู ุงูููุงุฑูุฉ ุงูุดุงูู:

| ุงูููุงู | ุงูุฃูุงู | ุงูุงุณุชุฎุฏุงู | ุงููุฎุงุทุฑ |
|--------|--------|----------|---------|
| **Authorization Header** | ๐ข ุงูุฃูุถู | APIs, SPAs | ููููุฉ |
| **Query Parameters** | ๐ด ุงูุฃุณูุฃ | ุชุฌูุจู! | Logging, Caching, Referer |
| **Request Body** | ๐ก ุฌูุฏ | POST endpoints | ูุด ุนููู ูู GET |
| **Cookies** | ๐ข ุฌูุฏ (ูุน Flags) | Web Apps | CSRF |
| **Custom Headers** | ๐ข ุฌูุฏ | Internal APIs | ุบูุฑ ููุงุณู |

### Best Practices:
```
โ ุงุณุชุฎุฏู Authorization Header ุฏุงููุงู
โ ุงุณุชุฎุฏู HTTPS ูุญูุงูุฉ ุงูู Token ุฃุซูุงุก ุงูููู
โ ูู ูุชุณุชุฎุฏู Cookies โ ุถูู HttpOnly + Secure + SameSite
โ ุฎูู ุงูู Token ุนูุฑู ูุตูุฑ (Short-Lived)
โ ุงุนูู Token Rotation (ุจุฏูู ุงูู Token ุจุดูู ุฏูุฑู)
โ ูุชุญุทุด ุงูู Token ูู ุงูู URL ุฃุจุฏุงู
โ ูุชุฎุฒูุด ุงูู Token ูู localStorage ูู ูููู (XSS Risk)
```

---

## ๐ฏ ููุฎุต ุงูุฌูุณุฉ ุงูุซุงููุฉ

| ุงูููููู | ุงูุดุฑุญ | ุงูุฃูููุฉ |
|---------|-------|---------|
| **CSRF** | ุงุณุชุบูุงู ุซูุฉ ุงูุชุทุจูู ูู ูุชุตูุญ ุงููุณุชุฎุฏู | ูู ุฃุฎุทุฑ ุงููุฌูุงุช ุนูู Web Apps |
| **CSRF Token** | Token ุณุฑู ูู ูู Form ููุญูุงูุฉ | ุงูุญู ุงูุฃุณุงุณู ุถุฏ CSRF |
| **SameSite Cookie** | ููุน ุฅุฑุณุงู Cookies Cross-Site | ุญู ุญุฏูุซ ููุนุงู |
| **Token-Based Auth** | ุจุฏูู ุญุฏูุซ ููู Sessions | Stateless + Scalable |
| **Bearer Token** | ุฃุจุณุท ุฃููุงุน ุงูู Tokens | ุงูุฃูุซุฑ ุดููุนุงู |
| **JWT** | Token ูุญุชูู ุนูู ุจูุงูุงุช + ุชูููุน | ุฃููู ูุฃุดูุฑ ููุน |
| **OAuth Tokens** | Access + Refresh Tokens | ููุชูููุถ ุจูู ุชุทุจููุงุช |
| **Token Placement** | ุฃูู ูุฎุฒู ุงูู Token | Authorization Header = ุงูุฃูุถู |

> ุงูุฌูุณุฉ ุงูุฌุงูุฉ ููุฏุฎู ูู **JWT ุจุงูุชูุตูู** โ ุงูู Structure (Header + Payload + Signature)ุ ุงูู Claimsุ ูุฃุฎุทุฑ ุซุบุฑุฉ ููู: **None Algorithm Attack**.
